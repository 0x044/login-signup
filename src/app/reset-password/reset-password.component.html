<div class="reset-password-container">
  <div class="reset-password-card">
    <!-- Header -->
    <div class="header">
      <button mat-icon-button (click)="goBack()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1>Reset Password</h1>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-message">
      <mat-icon>error</mat-icon>
      <p>{{errorMessage}}</p>
    </div>

    <!-- Success Message -->
    <div *ngIf="successMessage" class="success-message">
      <mat-icon>check_circle</mat-icon>
      <p>{{successMessage}}</p>
    </div>

    <!-- Reset Form -->
    <form [formGroup]="resetForm" (ngSubmit)="submitResetPassword()" class="reset-form">
      <div class="form-content">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Username</mat-label>
          <input matInput 
                 formControlName="username"
                 placeholder="Enter your username">
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="hasError('username')">
            {{getErrorMessage('username')}}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Current Password</mat-label>
          <input matInput 
                 [type]="showPassword ? 'text' : 'password'"
                 formControlName="oldPassword"
                 placeholder="Enter your current password">
          <mat-icon matSuffix (click)="togglePasswordVisibility()" class="password-toggle">
            {{showPassword ? 'visibility_off' : 'visibility'}}
          </mat-icon>
          <mat-error *ngIf="hasError('oldPassword')">
            {{getErrorMessage('oldPassword')}}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>New Password</mat-label>
          <input matInput 
                 [type]="showPassword ? 'text' : 'password'"
                 formControlName="newPassword"
                 placeholder="Enter your new password">
          <mat-icon matSuffix (click)="togglePasswordVisibility()" class="password-toggle">
            {{showPassword ? 'visibility_off' : 'visibility'}}
          </mat-icon>
          <mat-error *ngIf="hasError('newPassword')">
            {{getErrorMessage('newPassword')}}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirm New Password</mat-label>
          <input matInput 
                 [type]="showConfirmPassword ? 'text' : 'password'"
                 formControlName="confirmPassword"
                 placeholder="Confirm your new password">
          <mat-icon matSuffix (click)="toggleConfirmPasswordVisibility()" class="password-toggle">
            {{showConfirmPassword ? 'visibility_off' : 'visibility'}}
          </mat-icon>
          <mat-error *ngIf="hasError('confirmPassword')">
            {{getErrorMessage('confirmPassword')}}
          </mat-error>
        </mat-form-field>

        <!-- Password Requirements -->
        <div class="password-requirements" *ngIf="resetForm.get('newPassword')?.value">
          <h4>Password Requirements:</h4>
          <div class="requirements-list">
            <div class="requirement-item" [class.valid]="getPasswordRequirements().hasMinLength">
              <mat-icon>{{getPasswordRequirements().hasMinLength ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
              <span>At least 8 characters</span>
            </div>
            <div class="requirement-item" [class.valid]="getPasswordRequirements().hasUpperCase">
              <mat-icon>{{getPasswordRequirements().hasUpperCase ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
              <span>One uppercase letter</span>
            </div>
            <div class="requirement-item" [class.valid]="getPasswordRequirements().hasLowerCase">
              <mat-icon>{{getPasswordRequirements().hasLowerCase ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
              <span>One lowercase letter</span>
            </div>
            <div class="requirement-item" [class.valid]="getPasswordRequirements().hasNumeric">
              <mat-icon>{{getPasswordRequirements().hasNumeric ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
              <span>One number</span>
            </div>
            <div class="requirement-item" [class.valid]="getPasswordRequirements().hasSpecialChar">
              <mat-icon>{{getPasswordRequirements().hasSpecialChar ? 'check_circle' : 'radio_button_unchecked'}}</mat-icon>
              <span>One special character (#$%^&+=)</span>
            </div>
          </div>
        </div>

        <!-- Password Match Indicator -->
        <div class="password-match" *ngIf="resetForm.get('confirmPassword')?.value">
          <div class="match-indicator" [class.valid]="passwordsMatch()">
            <mat-icon>{{passwordsMatch() ? 'check_circle' : 'error'}}</mat-icon>
            <span>{{passwordsMatch() ? 'Passwords match' : 'Passwords do not match'}}</span>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button mat-button type="button" (click)="goBack()" class="cancel-button">
          Cancel
        </button>
        <button mat-raised-button 
                color="primary" 
                type="submit"
                [disabled]="resetForm.invalid || isLoading"
                class="submit-button">
          <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!isLoading">lock_reset</mat-icon>
          {{isLoading ? 'Resetting...' : 'Reset Password'}}
        </button>
      </div>
    </form>

    <!-- Help Text -->
    <div class="help-text">
      <p>
        <mat-icon>info</mat-icon>
        If you don't remember your current password, please contact support or use the forgot password feature.
      </p>
    </div>
  </div>
</div>

